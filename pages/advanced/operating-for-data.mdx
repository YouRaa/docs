import Page from '@reason/pages/Docs';
export default Page({title: "Data Querying for Node Operators"});

# Запросы Данных для Операторов Нод

Некоторые операторы нод не желают участвовать в производстве блоков или быть снарк-воркерами, а хотят просто находиться в сети и пассивно собирать информацию для запросов или отправки подписанных транзакций. Для этих нод не требуется наличие пары ключей аккаунта для успешной работы.

## Подготовка

В дополнение к [установке Mina daemon на ваш компьютер](/docs/getting-started), вам также может понадобиться настроить систему для архивирования данных на вашем компьютере. Для этого вы можете настроить [архивную ноду](/docs/archive-node) и/или архивировать данные, используя [другие способы](/docs/archive-redundancy).

## Запуск ноды

Лучший способ научиться разворачивать ноду - следовать инструкциям в документации на [Странице подключения](/docs/connecting).

Тем не менее, вы должны удалить флаги `CODA_PRIVKEY_PASS` и `-block-producer-key ...`, поскольку мы не хотим, чтобы эта нода была блок-продюсером.

Чтобы предоставить последнюю информацию о блокчейне, нам нужно использовать GraphQL REST сервер. Вы можете предоставить `-rest-server-port XXXX`, если используемые по умолчанию 0xc0d или 3085 вам не подходят. Вы также можете предоставить `-insecure-rest-server`, чтобы сделать REST сервер доступным вне` localhost`. Однако, если вы это сделаете, убедитесь в правильности настроек вашего брандмауэра. Смотрите [страницу GraphQL API](/docs/developers/graphql-api) для получения дополнительной информации.

## Запрос информации

Presented here are examples about querying for _recent_ information on the chain -- in practice exposed is ~10 hours of recent activity in the remaining testnets and the first version of Mainnet. As Mina is a succinct blockchain, for historical information can be accessed using [some sort of archival process](/docs/archive-redundancy)

The best way to explore all the specific details available for each of the GraphQL objects is to visit your favorite web browser pointing to the REST server running from within a Mina daemon that hosts a GraphQL sandbox. Visit the [GraphQL API page](/docs/developers/graphql-api) to learn more. Documentation is also present on most of the individual fields, you can learn more about each field by hovering over the entries in the sandbox or by visiting the [hosted schema](/graphql-docs/).

### Block data

```javascript
query BlockData {
  bestChain(maxLength: 10) {
    stateHash
    creatorAccount {
      balance {
        total
      }
    }
  }
}
```

We will soon add support for a `block` query that can request specific blocks within either the bestChain or any of the forks we are still holding in our node. See [#7404](https://github.com/MinaProtocol/mina/issues/7404) for more.

### Current Balance

The following is a query for accessing the current balance of a public key. Note that you can also ask for the blockHeight and stateHash of the block that this balance is inspected within.

```javascript
query CurrentBalance {
  account(publicKey: "B62qmyjqEtUEZrsBpUaiz18DCkwh1ovCrJboiHbDhpvH8JEoaag5fUP") {
    balance {
      blockHeight
      total
      stateHash
    }
  }
}
```

### Staking Information

In Mina, accounts are either staked or delegated completely. There is no alternative state. The following is a way to query this information that is present in the current ledger.

```javascript
query StakingInfo {
  account(publicKey: "B62qmyjqEtUEZrsBpUaiz18DCkwh1ovCrJboiHbDhpvH8JEoaag5fUP") {
    balance {
      blockHeight
      total
      stateHash
    }
    delegateAccount {
      publicKey
    }
  }
}
```

If the delegateAccount.publicKey is null, then this account is "staking directly" and this private key should be used for block production directly.

Note that the actual staking and delegating in the current "epoch" is drawn from the "staking ledger". We are currently implementing a mechanism for accessing this staking ledger directly, but for now you'll need to periodically query for this information and store it internally and then refer to it when it becomes active. On epoch transitions, a new staking ledger is selected by promoting the snarked ledger of the last block two epochs prior. In practice, this is between 2-4 weeks.

### Get Transaction Details

Via GraphQL, you can lookup transactions within blocks on the bestChain as follows:

```javascript
query TransactionDetails {
  bestChain(maxLength: 10) {
    stateHash
    creatorAccount {
      balance {
        total
      }
    }
    transactions {
      coinbase
      userCommands {
        amount
        fee
        feePayer {
          publicKey
        }
        hash
        isDelegation
        kind
        memo
        nonce
        receiver {
          publicKey
        }
        source {
          publicKey
        }
      }
    }
  }
}
```

## Submit a Signed Transaction

You can send a signed transaction using the following GraphQL mutation. You can get information about the payment returned back to you as a sanity check.

```javascript
mutation SubmitSignedTransaction {
  __typename
  sendPayment(input: {
    fee: "3000000",
    amount: "42",
    to: "B62qrcFstkpqXww1EkSGrqMCwCNho86kuqBd4FrAAUsPxNKdiPzAUsy",
    from: "B62qiy32p8kAKnny8ZFwoMhYpBppM1DWVCqAPBYNcXnsAHhnfAAuXgg",
    nonce: "0",
    memo: "This is a memo",
    validUntil: "50000"
  }, signature: {
      field: "26393275544831950408026742662950427846842308902199169146789849923161392179806",
      scalar: "28530962508461835801829592060779431956054746814505059654319465133050504973404"
   }) {
    payment {
      amount
      fee
      kind
      memo
      nonce
      source {
        publicKey
      }
      receiver {
        publicKey
      }
      isDelegation
    }
  }
}
```


